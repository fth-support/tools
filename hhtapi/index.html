# Create the HTML content for the tool
html_content = """
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Log API Analyzer</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            margin: 20px; 
            background-color: #f4f7f6; 
            color: #333;
        }
        h1 { color: #0056b3; }
        #app-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        #drop-zone { 
            border: 2px dashed #007bff; 
            padding: 30px; 
            text-align: center; 
            background-color: #f8faff; 
            margin-bottom: 20px; 
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        #drop-zone:hover {
            background-color: #f0f6ff;
            border-color: #0056b3;
        }
        #drop-zone.drag-over { 
            border-color: #0056b3; 
            background-color: #e6f0ff; 
            border-style: solid;
        }
        #fileInput { display: none; }
        #fileList { 
            margin-top: 15px; 
            font-style: italic; 
            color: #555; 
            font-size: 0.9em;
        }
        #analyzeButton { 
            background-color: #28a745; 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            border-radius: 5px; 
            font-size: 16px; 
            font-weight: bold;
            cursor: pointer; 
            margin-top: 10px;
            display: none; /* Hide until files are selected */
            width: 100%;
            transition: background-color 0.2s;
        }
        #analyzeButton:hover { background-color: #218838; }
        #resultsTable { margin-top: 25px; overflow-x: auto; }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            background-color: #fff; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
            border-radius: 5px;
            overflow: hidden;
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 12px; 
            text-align: left; 
        }
        th { 
            background-color: #007bff; 
            color: white;
            font-size: 0.95em;
        }
        tr:nth-child(even) { background-color: #f9f9f9; }
        tr:hover { background-color: #f1f1f1; }
        td:first-child, th:first-child {
            font-weight: bold;
            background-color: #f8f9fa;
        }
        td:last-child {
            font-weight: bold;
            background-color: #f8f9fa;
        }
        #loading { 
            display: none; 
            font-size: 1.2em; 
            color: #0056b3; 
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div id="app-container">
        <h1>เครื่องมือวิเคราะห์ Log API (Log Analyzer)</h1>
        <p>ลากไฟล์ Log (.txt) ของคุณมาวางในกล่องด้านล่าง หรือกดที่กล่องเพื่อเลือกไฟล์ (รองรับหลายไฟล์)</p>
        
        <div id="drop-zone" onclick="document.getElementById('fileInput').click();">
            คลิก หรือ ลากไฟล์มาวางที่นี่
            <input type="file" id="fileInput" multiple accept=".txt,.log">
            <div id="fileList">ยังไม่ได้เลือกไฟล์</div>
        </div>
        
        <button id="analyzeButton">วิเคราะห์ข้อมูล</button>
        <div id="loading">กำลังประมวลผล...</div>
        
        <div id="resultsTable">
            </div>
    </div>

    <script>
        // --- นี่คือ Logic การวิเคราะห์ที่เราใช้ครับ ---
        
        const mappings = {
            '[POST][/api/v1/orderings/upload]': 'สั่งซื้อสินค้า',
            '[POST][/api/v1/receivings/upload]': 'รับสินค้า',
            '[POST][/api/v1/checkProducts/upload]': 'ตรวจเช็คสินค้า',
            '[POST][/api/v1/priceTags/txt]': 'ป้ายราคา',
            '[POST][/api/v1/selfAudits/upload]': 'นับสินค้า',
            '[POST][/api/v1/outOfShelves/upload]': 'OOS Check'
        };
        
        const columnOrder = [
            'สั่งซื้อสินค้า',
            'รับสินค้า',
            'ตรวจเช็คสินค้า',
            'ป้ายราคา',
            'นับสินค้า',
            'OOS Check'
        ];
        
        // Regex เพื่อดึงวันที่
        const timestampRegex = /time="(\d{4}-\d{2}-\d{2}T[0-9:]{8}\+07:00)"/;
        
        // --- ส่วนควบคุมหน้าเว็บ (DOM) ---
        
        const fileInput = document.getElementById('fileInput');
        const analyzeButton = document.getElementById('analyzeButton');
        const resultsTable = document.getElementById('resultsTable');
        const loading = document.getElementById('loading');
        const dropZone = document.getElementById('drop-zone');
        const fileListDiv = document.getElementById('fileList');

        let selectedFiles = [];

        function updateFileList() {
            if (selectedFiles.length === 0) {
                fileListDiv.textContent = 'ยังไม่ได้เลือกไฟล์';
                analyzeButton.style.display = 'none';
            } else {
                fileListDiv.textContent = selectedFiles.length + ' ไฟล์ถูกเลือก: ' + Array.from(selectedFiles).map(f => f.name).join(', ');
                analyzeButton.style.display = 'block';
            }
        }

        // Event Listeners สำหรับการเลือกไฟล์
        fileInput.addEventListener('change', (e) => {
            selectedFiles = Array.from(e.target.files);
            updateFileList();
        });

        // Event Listeners สำหรับ Drag and Drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });
        dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            selectedFiles = Array.from(e.dataTransfer.files);
            fileInput.files = e.dataTransfer.files; // Sync กับ input
            updateFileList();
        });

        // Event Listener สำหรับปุ่มวิเคราะห์
        analyzeButton.addEventListener('click', () => {
            if (selectedFiles.length === 0) {
                alert('กรุณาเลือกไฟล์ Log ก่อนครับ');
                return;
            }
            
            loading.style.display = 'block';
            resultsTable.innerHTML = '';
            
            processFiles(selectedFiles);
        });

        // --- Logic การประมวลผลไฟล์ ---
        
        function processFiles(files) {
            const counts_by_date = {};
            const fileReadPromises = [];

            for (const file of files) {
                fileReadPromises.push(readFileAsText(file, counts_by_date));
            }

            Promise.all(fileReadPromises).then(() => {
                loading.style.display = 'none';
                displayResults(counts_by_date);
            }).catch(error => {
                loading.style.display = 'none';
                resultsTable.innerHTML = `<p style="color: red;">เกิดข้อผิดพลาด: ${error.message}</p>`;
            });
        }
        
        function readFileAsText(file, counts_by_date) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const content = e.target.result;
                        // ใช้ \\r?\\n เพื่อรองรับทั้ง Windows และ Unix
                        const lines = content.split(/\\r?\\n/);
                        
                        for (const line of lines) {
                            if (line.trim() === '') continue;

                            for (const [api_call, function_name] of Object.entries(mappings)) {
                                if (line.includes(api_call)) {
                                    
                                    // *** นี่คือ Filter สำคัญ ***
                                    // กรอง Error 400 Bad Request ออก ไม่นับ
                                    if (line.includes('status_code="400 Bad Request"') || line.includes('code":400')) {
                                        break; // ไม่นับ Log ที่ล้มเหลว
                                    }
                                    
                                    const match = timestampRegex.exec(line);
                                    if (match && match[1]) {
                                        const date_str = match[1].split('T')[0];
                                        
                                        // สร้าง object ถ้ายังไม่มี
                                        if (!counts_by_date[date_str]) {
                                            counts_by_date[date_str] = {};
                                        }
                                        if (!counts_by_date[date_str][function_name]) {
                                            counts_by_date[date_str][function_name] = 0;
                                        }
                                        
                                        // นับเพิ่ม
                                        counts_by_date[date_str][function_name]++;
                                    }
                                    break; // เจอ mapping แล้ว ไปบรรทัดถัดไป
                                }
                            }
                        }
                        resolve();
                    } catch (err) {
                        reject(err);
                    }
                };
                reader.onerror = (e) => {
                    reject(new Error('ไม่สามารถอ่านไฟล์ ' + file.name));
                };
                reader.readAsText(file, 'UTF-8');
            });
        }

        // --- Logic การแสดงผล ---

        function displayResults(counts_by_date) {
            const sortedDates = Object.keys(counts_by_date).sort();
            
            if (sortedDates.length === 0) {
                resultsTable.innerHTML = '<p>ไม่พบข้อมูลที่ตรงกับเงื่อนไขในไฟล์ที่เลือกครับ</p>';
                return;
            }
            
            let html = '<table><thead><tr><th>Date</th>';
            for (const col of columnOrder) {
                html += `<th>${col}</th>`;
            }
            html += '<th>Total</th></tr></thead><tbody>';
            
            for (const date of sortedDates) {
                html += `<tr><td>${date}</td>`;
                let total_for_date = 0;
                for (const col of columnOrder) {
                    const count = counts_by_date[date][col] || 0;
                    html += `<td>${count}</td>`;
                    total_for_date += count;
                }
                html += `<td><b>${total_for_date}</b></td></tr>`;
            }
            
            html += '</tbody></table>';
            resultsTable.innerHTML = html;
        }
    </script>
    </body>
    </html>
"""

# Save the HTML content to a file, this time named "index.html"
file_name = "index.html"
with open(file_name, "w", encoding="utf-8") as f:
    f.write(html_content)

print(f"File '{file_name}' created successfully.")
